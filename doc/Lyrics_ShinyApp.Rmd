---
title: "Lyrics ShinyApp"
author: "Chengliang Tang, Arpita Shah and Tian Zheng"
output: html_notebook
runtime: shiny
---

"lyrics_filter.csv" is a filtered corpus of 380,000+ song lyrics from from MetroLyrics. You can read more about it on [Kaggle](https://www.kaggle.com/gyani95/380000-lyrics-from-metrolyrics).

"info_artist.csv" provides the background information of all the artistis. These information are scraped from [LyricsFreak](https://www.lyricsfreak.com/).

Here, we explore these data sets and try to find interesting patterns.

### Load all the required libraries

From the packages' descriptions:

+ `tidyverse` is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures;
+ `tidytext` allows text mining using 'dplyr', 'ggplot2', and other tidy tools;
+ `DT` provides an R interface to the JavaScript library DataTables;
+ `scales` map data to aesthetics, and provide methods for automatically determining breaks and labels for axes and legends;
+ `wordcloud2` provides an HTML5 interface to wordcloud for data visualization;
+ `gridExtra` contains miscellaneous functions for "grid" graphics;
+ `ngram` is for constructing n-grams (“tokenizing”), as well as generating new text based on the n-gram structure of a given text input (“babbling”);
+ `Shiny` is an R package that makes it easy to build interactive web apps straight from R;

```{r load libraries, warning=FALSE, message=FALSE}
library(tidyverse)
library(tidytext)
library(DT)
library(tm)
library(data.table)
library(scales)
library(wordcloud2)
library(gridExtra)
library(ngram)
library(shiny) 
```

### Load the processed lyrics data along with artist information

We use the processed data and artist information for our analysis.

```{r load data, warning=FALSE, message=FALSE}
# load lyrics data
dt_lyrics <- fread('../output/processed_lyrics.csv') 
# load artist information
dt_artist <- fread('../data/artists.csv') 
```

### Make Document Term Matrix for visualization
```{r}
corpus <- VCorpus(VectorSource(dt_lyrics$text))
dtm <- DocumentTermMatrix(corpus,
                          control = list(weighting = function(x)
                                             weightTfIdf(x, 
                                                         normalize =FALSE),
                                         stopwords = TRUE))
lyrics_list <- c("Folk", "R&B", "Electronic", "Jazz", "Indie", "Country", "Rock", "Metal", "Pop", "Hip-Hop", "Other")
ff.dtm=tidy(dtm)
```

### Specify the user interface for the R Shiny app

```{r shiny UI, warning=FALSE, message=FALSE}
ui <- navbarPage("From Elvis to Adele",
                 tabPanel("Overview",
                          
                          titlePanel(h1("Most Frequent Words",
                                        align = "center")),
                          
                          sidebarLayout(
                            sidebarPanel(
                              sliderInput(inputId = "nwords",
                                          label = "Number of terms for word cloud:",
                                          min = 5,
                                          max = 100,
                                          value = 50),
                              br(),
                              br(),
                              
                              selectInput('genre', 'Genre of the word cloud', 
                                          lyrics_list, 
                                          selected='Jazz')
                            ),
                            
                            mainPanel(
                              wordcloud2Output(outputId = "WC", height = "600px")
                              
                            )
                          )
                 ),
                 
                 tabPanel("Data",
                          DT::dataTableOutput("table")
                          )
)
```

### Develop the server for the R Shiny app

This shiny app visualizes summary of data and displays the data table itself.

```{r shiny server, warning=FALSE, message=FALSE}
server <- function(input, output, session) {
  # Combine the selected variables into a new data frame
  
  
  selectedData <- reactive({
    list(term=ff.dtm$term[ff.dtm$document==as.character(which(dt_lyrics$genre == input$genre))],
         count=as.integer(ff.dtm$count[ff.dtm$document==as.character(which(dt_lyrics$genre == input$genre))]))
  })
  
  output$WC <- renderWordcloud2({
    
    data.frame(selectedData()$term, 
                  selectedData()$count) %>%
      slice(1:input$nwords)%>%
      wordcloud2(size = 0.6,
                 rotateRatio = 0)
    
  })
  
  output$table <- DT::renderDataTable({
    DT::datatable(dt_lyrics)
  })
}
```


### Run the R Shiny app

```{r shiny app, warning=FALSE, message=FALSE}
shinyApp(ui, server)
```






